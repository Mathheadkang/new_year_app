<!--pages/history/history.wxml-->
<view class="container">
  <view class="header">
    <text class="title">历史记录</text>
  </view>

  <view class="empty" wx:if="{{historyList.length === 0}}">
    <text class="empty-text">暂无历史记录</text>
    <text class="empty-hint">去生成你的第一副春联吧！</text>
  </view>

  <!-- 普通视图（< 6 条） -->
  <view class="history-list" wx:if="{{!useGroupView && historyList.length > 0}}">
    <view class="slide-container" wx:for="{{historyList}}" wx:key="id">
      <view class="history-item {{slideIndex === index ? 'slide-left' : ''}}" 
            bindtouchstart="touchStart" 
            bindtouchmove="touchMove" 
            bindtouchend="touchEnd"
            bindtap="viewItem" 
            data-itemindex="{{index}}">
        <view class="item-header">
          <view class="name-info">
            <text class="name">「{{item.name}}」</text>
            <text class="position-badge">{{item.position === 'head' ? '藏头' : item.position === 'middle' ? '藏中' : '藏尾'}}</text>
          </view>
          <text class="date">{{item.timestamp}}</text>
        </view>
        <view class="item-content">
          <view class="horizontal-scroll">{{item.horizontal}}</view>
          <view class="couplet-lines">
            <view class="couplet-line">{{item.upper}}</view>
            <view class="couplet-line">{{item.lower}}</view>
          </view>
        </view>
      </view>
      <view class="delete-btn" bindtap="deleteItem" data-itemindex="{{index}}">删除</view>
    </view>
  </view>

  <!-- 分组视图（>= 6 条） -->
  <view class="history-list" wx:if="{{useGroupView}}">
    <view class="group-container" wx:for="{{groupedHistory}}" wx:key="name" wx:for-item="group" wx:for-index="groupIndex">
      <!-- 分组头部（可折叠） -->
      <view class="group-header" bindtap="toggleGroup" data-index="{{groupIndex}}">
        <view class="name-info">
          <text class="name">「{{group.name}}」</text>
          <text class="count-badge">{{group.count}}条</text>
        </view>
        <view class="arrow {{group.expanded ? 'expanded' : ''}}">▼</view>
      </view>
      
      <!-- 分组内容（展开时显示） -->
      <view class="group-items" wx:if="{{group.expanded}}">
        <view class="slide-container" wx:for="{{group.items}}" wx:key="id">
          <view class="history-item {{slideIndex === groupIndex + '-' + index ? 'slide-left' : ''}}" 
                bindtouchstart="touchStart" 
                bindtouchmove="touchMove" 
                bindtouchend="touchEnd"
                bindtap="viewItem" 
                data-groupindex="{{groupIndex}}" 
                data-itemindex="{{index}}">
            <view class="item-header">
              <text class="position-badge">{{item.position === 'head' ? '藏头' : item.position === 'middle' ? '藏中' : '藏尾'}}</text>
              <text class="date">{{item.timestamp}}</text>
            </view>
            <view class="item-content">
              <view class="horizontal-scroll">{{item.horizontal}}</view>
              <view class="couplet-lines">
                <view class="couplet-line">{{item.upper}}</view>
                <view class="couplet-line">{{item.lower}}</view>
              </view>
            </view>
          </view>
          <view class="delete-btn" bindtap="deleteItem" data-groupindex="{{groupIndex}}" data-itemindex="{{index}}">删除</view>
        </view>
      </view>
    </view>
  </view>

  <view class="clear-btn-wrapper" wx:if="{{historyList.length > 0}}">
    <button class="clear-btn" bindtap="clearHistory">清空历史</button>
  </view>
</view>
